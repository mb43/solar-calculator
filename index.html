<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Battery Economics Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .status {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            color: #1976d2;
        }
        
        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .input-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #3498db;
        }
        
        .input-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .input-row {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .calculate-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            display: none;
        }
        
        .results h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 2em;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .result-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .result-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .business-highlight {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .business-highlight h4 {
            color: #155724;
            margin-bottom: 10px;
        }
        
        .assumptions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .assumptions h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .assumptions ul {
            color: #856404;
            margin: 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ Solar + Battery Economics Calculator</h1>
        
        <div id="status" class="status">
            Loading JavaScript...
        </div>
        
        <div class="business-highlight">
            <h4>üéØ Business Energy Cost Analysis</h4>
            <p>Calculate the financial impact of solar panels and battery storage for your operation. This tool models 25-year savings with real UK energy tariff data.</p>
        </div>
        
        <div style="background: #e8f4f8; padding: 20px; border-radius: 15px; margin-bottom: 30px; border-left: 5px solid #3498db;">
            <h3>Select Business Tariff</h3>
            <select id="tariffType" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 1em;">
                <option value="trio">Shape Shifters: Trio (3 guaranteed rates, 21hrs cheaper electricity)</option>
                <option value="agile">Shape Shifters: Agile (Dynamic half-hourly pricing)</option>
                <option value="flux">Octopus Flux (Solar + Battery optimized)</option>
                <option value="residential">Residential Tariff (for comparison)</option>
            </select>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                <strong>Shape Shifters:</strong> Trial results show 100% of businesses saved money, with some achieving ¬£2,000+ annual savings.
            </p>
        </div>
        
        <div class="inputs-grid">
            <div class="input-group">
                <h3>‚ö° System Specifications</h3>
                <div class="input-row">
                    <label for="solarCapacity">Solar PV Capacity (kW)</label>
                    <input type="number" id="solarCapacity" value="30" step="0.1">
                </div>
                <div class="input-row">
                    <label for="batteryCapacity">Battery Storage (kWh)</label>
                    <input type="number" id="batteryCapacity" value="360" step="1">
                </div>
                <div class="input-row">
                    <label for="continuousLoad">Continuous Load (kW)</label>
                    <input type="number" id="continuousLoad" value="120" step="1">
                </div>
                <div class="input-row">
                    <label for="loadFactor">Load Factor (%)</label>
                    <input type="number" id="loadFactor" value="95" step="1">
                </div>
            </div>
            
            <div class="input-group">
                <h3>üí∞ Financial Parameters</h3>
                <div class="input-row">
                    <label for="initialCost">Initial Infrastructure Cost (¬£)</label>
                    <input type="number" id="initialCost" value="250000" step="1000">
                </div>
                <div class="input-row">
                    <label for="analysisYears">Analysis Period (years)</label>
                    <input type="number" id="analysisYears" value="25" step="1">
                </div>
                <div class="input-row">
                    <label for="discountRate">Discount Rate (%)</label>
                    <input type="number" id="discountRate" value="3.5" step="0.1">
                </div>
                <div class="input-row">
                    <label for="inflationRate">Energy Price Inflation (%)</label>
                    <input type="number" id="inflationRate" value="2.5" step="0.1">
                </div>
            </div>
            
            <div class="input-group">
                <h3>‚ö° Energy Rates (p/kWh)</h3>
                <div class="input-row">
                    <label for="nightRate">Night Rate (00:00-07:00)</label>
                    <input type="number" id="nightRate" value="8.0" step="0.1">
                </div>
                <div class="input-row">
                    <label for="dayRate">Day Rate (other times)</label>
                    <input type="number" id="dayRate" value="18.0" step="0.1">
                </div>
                <div class="input-row">
                    <label for="peakRate">Peak Rate (16:00-19:00)</label>
                    <input type="number" id="peakRate" value="35.0" step="0.1">
                </div>
                <div class="input-row">
                    <label for="exportRate">Export Rate</label>
                    <input type="number" id="exportRate" value="30.0" step="0.1">
                </div>
            </div>
            
            <div class="input-group">
                <h3>üìä Performance</h3>
                <div class="input-row">
                    <label for="solarYield">Annual Solar Yield (kWh/kWp)</label>
                    <input type="number" id="solarYield" value="950" step="10">
                </div>
                <div class="input-row">
                    <label for="batteryStrategy">Battery Strategy (%)</label>
                    <input type="number" id="batteryStrategy" value="50" step="1">
                </div>
                <div class="input-row">
                    <label for="solarDegradation">Solar Degradation (%/year)</label>
                    <input type="number" id="solarDegradation" value="0.5" step="0.1">
                </div>
                <div class="input-row">
                    <label for="batteryDegradation">Battery Degradation (%/year)</label>
                    <input type="number" id="batteryDegradation" value="2.0" step="0.1">
                </div>
            </div>
        </div>
        
        <button class="calculate-btn" id="calculateBtn">
            Calculate 25-Year Savings üöÄ
        </button>
        
        <div id="results" class="results">
            <h2>üìà Financial Analysis Results</h2>
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-value" id="totalSavings">¬£0</div>
                    <div class="result-label">Total 25-Year Savings</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="annualSavings">¬£0</div>
                    <div class="result-label">Average Annual Savings</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="paybackPeriod">0</div>
                    <div class="result-label">Payback Period</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="roi">0%</div>
                    <div class="result-label">25-Year ROI</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="npv">¬£0</div>
                    <div class="result-label">Net Present Value</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="dailyLoad">0</div>
                    <div class="result-label">Daily Energy (kWh)</div>
                </div>
            </div>
            
            <div class="assumptions">
                <h4>üìã Key Assumptions</h4>
                <ul id="assumptionsList">
                </ul>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';
            
            // Tariff presets based on current UK rates
            const tariffPresets = {
                trio: {
                    nightRate: 8.0,      // Night rate (00:00-07:00)
                    dayRate: 18.0,       // Day rate (07:00-16:00, 19:00-00:00)
                    peakRate: 35.0,      // Peak rate (16:00-19:00)
                    exportRate: 30.0,    // Export rate during peak
                    description: "Shape Shifters: Trio - 21 hours of cheaper electricity daily"
                },
                agile: {
                    nightRate: 5.0,      // Can go negative on agile
                    dayRate: 15.0,       // Variable based on wholesale
                    peakRate: 45.0,      // Higher volatility on agile
                    exportRate: 40.0,    // Higher export potential
                    description: "Shape Shifters: Agile - Dynamic half-hourly pricing"
                },
                flux: {
                    nightRate: 7.5,      // Off-peak charging (02:00-05:00)
                    dayRate: 23.0,       // Standard rate
                    peakRate: 28.0,      // Peak rate (16:00-19:00)
                    exportRate: 28.0,    // Matched export rate
                    description: "Octopus Flux - Solar and battery optimized"
                },
                residential: {
                    nightRate: 7.0,      // Economy 7 night rate
                    dayRate: 24.0,       // Standard domestic rate
                    peakRate: 24.0,      // No peak differential
                    exportRate: 15.0,    // Standard export rate
                    description: "Residential Tariff - For comparison"
                }
            };
            
            function updateTariffRates() {
                try {
                    const tariffType = document.getElementById('tariffType').value;
                    const preset = tariffPresets[tariffType];
                    
                    if (preset) {
                        document.getElementById('nightRate').value = preset.nightRate;
                        document.getElementById('dayRate').value = preset.dayRate;
                        document.getElementById('peakRate').value = preset.peakRate;
                        document.getElementById('exportRate').value = preset.exportRate;
                        
                        updateStatus(`Tariff updated: ${preset.description}`);
                    }
                } catch (error) {
                    updateStatus('Error updating tariff: ' + error.message);
                }
            }
            
            function updateStatus(message) {
                const statusEl = document.getElementById('status');
                if (statusEl) {
                    statusEl.textContent = message;
                    console.log(message);
                }
            }

            function calculate() {
                try {
                    updateStatus('Calculating...');
                    
                    // Get all inputs
                    const getValue = (id) => parseFloat(document.getElementById(id).value) || 0;
                    
                    const inputs = {
                        solarCapacity: getValue('solarCapacity'),
                        batteryCapacity: getValue('batteryCapacity'),
                        continuousLoad: getValue('continuousLoad'),
                        loadFactor: getValue('loadFactor') / 100,
                        initialCost: getValue('initialCost'),
                        analysisYears: parseInt(getValue('analysisYears')),
                        discountRate: getValue('discountRate') / 100,
                        inflationRate: getValue('inflationRate') / 100,
                        nightRate: getValue('nightRate') / 100,
                        dayRate: getValue('dayRate') / 100,
                        peakRate: getValue('peakRate') / 100,
                        exportRate: getValue('exportRate') / 100,
                        solarYield: getValue('solarYield'),
                        batteryStrategy: getValue('batteryStrategy') / 100,
                        solarDegradation: getValue('solarDegradation') / 100,
                        batteryDegradation: getValue('batteryDegradation') / 100
                    };

                    // Basic calculations
                    const dailyLoad = inputs.continuousLoad * 24 * inputs.loadFactor;
                    const annualSolarGeneration = inputs.solarCapacity * inputs.solarYield;
                    const dailySolar = annualSolarGeneration / 365;
                    
                    // Load distribution (24/7 operation)
                    const nightLoad = inputs.continuousLoad * 7 * inputs.loadFactor; // 7 hours
                    const dayLoad = inputs.continuousLoad * 14 * inputs.loadFactor;  // 14 hours (7-16, 19-24)
                    const peakLoad = inputs.continuousLoad * 3 * inputs.loadFactor;  // 3 hours (16-19)
                    
                    let totalSavings = 0;
                    let cumulativeSavings = 0;
                    let paybackYear = null;
                    
                    // Year by year calculation
                    for (let year = 1; year <= inputs.analysisYears; year++) {
                        const solarPerformance = Math.pow(1 - inputs.solarDegradation, year - 1);
                        const batteryPerformance = Math.pow(1 - inputs.batteryDegradation, year - 1);
                        
                        const yearSolar = annualSolarGeneration * solarPerformance;
                        const yearDailySolar = yearSolar / 365;
                        const effectiveBattery = inputs.batteryCapacity * batteryPerformance;
                        
                        // Energy strategy
                        const maxBatteryUse = effectiveBattery * inputs.batteryStrategy;
                        const peakReduction = Math.min(peakLoad, maxBatteryUse);
                        const solarSelfUse = Math.min(yearDailySolar, dailyLoad * 0.6);
                        const excessSolar = Math.max(0, yearDailySolar - solarSelfUse);
                        
                        // Cost calculations
                        const baselineCost = (
                            nightLoad * inputs.nightRate +
                            dayLoad * inputs.dayRate +
                            peakLoad * inputs.peakRate
                        ) * 365;
                        
                        const optimizedCost = (
                            (nightLoad + peakReduction) * inputs.nightRate +
                            Math.max(0, dayLoad - solarSelfUse) * inputs.dayRate +
                            (peakLoad - peakReduction) * inputs.peakRate
                        ) * 365;
                        
                        const exportEarnings = Math.min(excessSolar, inputs.solarCapacity * 2) * inputs.exportRate * 365;
                        
                        const inflationFactor = Math.pow(1 + inputs.inflationRate, year - 1);
                        const annualSavings = (baselineCost - optimizedCost + exportEarnings) * inflationFactor;
                        
                        const discountFactor = Math.pow(1 + inputs.discountRate, year);
                        const presentValue = annualSavings / discountFactor;
                        
                        totalSavings += presentValue;
                        cumulativeSavings += annualSavings;
                        
                        if (!paybackYear && cumulativeSavings >= inputs.initialCost) {
                            paybackYear = year;
                        }
                    }
                    
                    // Calculate metrics
                    const netPresentValue = totalSavings - inputs.initialCost;
                    const averageAnnualSavings = totalSavings / inputs.analysisYears;
                    const roi = (totalSavings / inputs.initialCost - 1) * 100;
                    
                    // Update display
                    document.getElementById('totalSavings').textContent = '¬£' + Math.round(totalSavings).toLocaleString();
                    document.getElementById('annualSavings').textContent = '¬£' + Math.round(averageAnnualSavings).toLocaleString();
                    document.getElementById('paybackPeriod').textContent = paybackYear ? paybackYear + ' years' : '> ' + inputs.analysisYears + ' years';
                    document.getElementById('roi').textContent = roi.toFixed(1) + '%';
                    document.getElementById('npv').textContent = '¬£' + Math.round(netPresentValue).toLocaleString();
                    document.getElementById('dailyLoad').textContent = Math.round(dailyLoad).toLocaleString();
                    
                    // Update assumptions
                    const tariffType = document.getElementById('tariffType').value;
                    const selectedTariff = tariffPresets[tariffType];
                    
                    document.getElementById('assumptionsList').innerHTML = `
                        <li><strong>Tariff:</strong> ${selectedTariff.description}</li>
                        <li>24/7 operation at ${(inputs.loadFactor * 100).toFixed(0)}% load factor (${Math.round(dailyLoad).toLocaleString()} kWh/day)</li>
                        <li>Battery cycles ${(inputs.batteryStrategy * 100).toFixed(0)}% of capacity for peak shaving</li>
                        <li>Solar self-consumption: ${Math.round((Math.min(dailySolar, dailyLoad * 0.6)/dailyLoad)*100)}% of daily generation</li>
                        <li>Peak period: 16:00-19:00 at ${inputs.peakRate.toFixed(1)}p/kWh, Night: 00:00-07:00 at ${inputs.nightRate.toFixed(1)}p/kWh</li>
                        <li>Energy prices inflate at ${(inputs.inflationRate * 100).toFixed(1)}% annually</li>
                        <li>Discount rate: ${(inputs.discountRate * 100).toFixed(1)}% for NPV calculation</li>
                        <li>System degradation: Solar ${(inputs.solarDegradation * 100).toFixed(1)}%/year, Battery ${(inputs.batteryDegradation * 100).toFixed(1)}%/year</li>
                    `;
                    
                    // Show results
                    document.getElementById('results').style.display = 'block';
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                    
                    updateStatus('Calculation complete!');
                    
                } catch (error) {
                    updateStatus('Error: ' + error.message);
                    console.error('Calculation error:', error);
                }
            }

            // Initialize when page loads
            document.addEventListener('DOMContentLoaded', function() {
                updateStatus('Loading calculator...');
                
                // Set up calculate button
                const button = document.getElementById('calculateBtn');
                if (button) {
                    button.addEventListener('click', calculate);
                } else {
                    updateStatus('Error: Button not found');
                    return;
                }
                
                // Set up tariff selector
                const tariffSelector = document.getElementById('tariffType');
                if (tariffSelector) {
                    tariffSelector.addEventListener('change', updateTariffRates);
                    // Initialize with default tariff
                    updateTariffRates();
                } else {
                    updateStatus('Error: Tariff selector not found');
                    return;
                }
                
                updateStatus('Calculator ready! Select tariff and click Calculate.');
            });

        })();
    </script>
</body>
</html>
